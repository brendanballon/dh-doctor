<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>dh-doctor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;margin:2rem}
      header{margin-bottom:1rem}
      table{border-collapse:collapse;width:100%;margin:1rem 0}
      th,td{border:1px solid #ddd;padding:.5rem;text-align:left}
      th{background:#f2f2f2}
      .grid{display:grid;gap:1rem}
      .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem}
      .cards + .cards {margin-top: 1rem}
      .card + .cards {margin-top: 1rem}
      .card{border:1px solid #ddd;border-radius:.5rem;padding:1rem}
      .chart {border:1px solid #ddd;border-radius:0rem;padding:1rem}
      code{background:#f6f8fa;padding:.15rem .3rem;border-radius:.2rem}
      footer{margin-top:2rem;font-size:.9rem;color:#666}
    </style>
    <script>
        (function () {
          if (!("EventSource" in window)) {
            console.warn("SSE not supported by this browser");
            return;
          }
        
          const fmt = ts => new Date(ts * 1000).toLocaleTimeString();
        
          function apply(id, payload) {
            if (!payload) return;
            document.getElementById(id + "-ts").textContent = fmt(payload.ts_utc);
            document.getElementById(id + "-val").textContent = Number(payload.value).toFixed(3);
          }
        
          const es = new EventSource("/api/stream");
        
          es.onmessage = (evt) => {
            try {
              const data = JSON.parse(evt.data);
              apply("s1", data.sensor1);
              apply("s2", data.sensor2);
            } catch (e) {
              console.warn("Bad SSE payload", e);
            }
          };
        
          es.onerror = () => {
            // Browser will auto-reconnect. Keep a visual hint if you want.
            // document.title = "Reconnectingâ€¦";
          };
        })();
        </script>
  </head>
  <body>
    <header>
      <h1>dh-doctor</h1>
    </header>
    <main>
      {% block body %}{% endblock %}
    </main>
    <footer>
      <p>API: <code>/api/last?sensor_id=1&amp;n=5</code></p>
    </footer>
  </body>
</html>